name: start
description: Start work on the bead.
requires:
  - git
  - bd
safety:
  require_clean_worktree: true
  dry_run_support: true
inputs:
  bead_id:
    required: true
    description: Beads issue id (e.g., wf-123)
runs:
  - type: bd
    cmd: show ${positional[0]} --json
  - type: shell
    cmd: |
      # derive slug and branch
      title=$(node -e "const i=JSON.parse(process.stdin.read()); process.stdout.write((i[0].title||'work').toLowerCase().replace(/[^a-z0-9\s]/g,' ').trim().split(/\s+/).slice(0,6).join('-'))" <<< "$(cat)")
      branch=bd-${positional[0]}/${title}
      echo BRANCH:${branch}
  - type: bd
    cmd: update ${positional[0]} --status in_progress
  - type: shell
    cmd: git rev-parse --verify refs/heads/${positional[1]} || git checkout -b ${positional[1]}
  - type: bd
    cmd: update ${positional[0]} --external-ref branch:${positional[1]}
  - type: bd
    cmd: comments add ${positional[0]} "Branch created: ${positional[1]} (local)"
