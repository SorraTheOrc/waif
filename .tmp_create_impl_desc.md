Final headline

Implement an agent "Implementation skill" that, given a Producer-specified bead or intake, creates a feature branch, implements code changes (with tests and docs), pushes the branch, opens a GitHub PR with testing instructions and bead links, and records actions back to Beads. The agent may push branches and open PRs automatically; merges require a human reviewer after CI passes.


Problem
- There is no repo-scoped Implementation skill that can take a Producer request and produce a complete code change (branch + commits + tests + docs) and a GitHub PR. This slows delivery because engineers must manually implement trivial wiring and plumbing that could be automated, and it increases handoff friction for small, well-scoped work.

Users
- Primary: Producers / PMs who request implementation work from the agent stack.
- Secondary: Engineers and reviewers who will review, test, and merge PRs; automation (CI) that validates changes.

Success criteria
- Given a beads issue and confirmed scope, the Implementation skill:
  1) Creates a topic branch following repo convention (<beads_prefix>-<bd-id>/<short-desc>) and produces one or more commits implementing the requested change, including tests and concise documentation.
  2) Opens a GitHub PR with a clear body containing: intent, implementation overview, testing instructions (automated & manual), and links to the source bead(s).
  3) Updates the originating bead(s) / epic(s) with links to the created PR(s) and a short summary of changed files; adds a "next steps" list for discovered but out-of-scope follow-ups.
  4) Ensures CI/lint/tests pass before recommending merge; merges only after human reviewer approval (human-merge).
  5) Is idempotent: re-running against the same bead does not create duplicate PRs or duplicate bead links.
  - Done-test (explicit example): Running the skill against bd-123 creates branch bd-123/<short-desc>, opens PR linking bd-123, includes relevant tests and docs, CI passes, and bd-123 is updated with an external-ref to the PR and a short summary of files changed.

Constraints
- Security: No secrets may be added to commits, PR bodies, logs, or bead comments.
- Branch & PR policy: Agent may push branches and open PRs automatically; merges require a human reviewer (no auto-merge).
- Branch naming: Must follow <beads_prefix>-<bd-id>/<short-desc>.
- Implementation must include tests and concise documentation and include clear instructions for automated and manual verification in the PR body.
- The agent must not unilaterally change bead assignees without explicit Producer instruction (propose-only for assignment changes unless explicitly told otherwise).

Existing state
- .opencode/command/intake.md — intake process & interview templates to capture scope (agent: build).
- .opencode/command/implement.md — implementation workflow for agents (agent: patch). Defines safety gate for uncommitted changes, definition checklist, automated review stages, commit/push/PR steps, and bead update rules.
- .opencode/command/doc.md — docs authoring command (agent: scribbler). Defines pre-implementation doc responsibilities, temp draft location, and bead write-back process.
- Other relevant .opencode/command files: plan.md, prd.md, review.md, testplan.md, landThePlane.md, design.md, milestones.md — these define adjacent steps (planning, PRD authoring, test guidance, review, landing) that the Implementation skill must integrate with or respect.
- docs/dev/prd/opencode_integration_PRD.md — OpenCode integration PRD (parent epic wf-gn7).
- docs/dev/CONTEXT_PACK.md, docs/Workflow.md — repo context & PRD-driven workflow guidance.
- Beads: wf-gn7 (OpenCode integration epic — chosen parent), wf-70j.* (PM/skill family: intake, PRD linking, plan generation), wf-5e2 (PM: decompose PRD into bead plan).

Desired change
- Implement an agent skill ("Implementation skill") that accepts a Producer-specified bead (or freeform request per /intake), implements the requested code changes on a branch, pushes the branch, opens a PR (with tests & docs), and records actions back to beads. Produce "next step" recommendations for any discovered out-of-scope work and link them from the bead.

Likely duplicates / related docs
- docs/dev/CONTEXT_PACK.md — repo context & agent guidance
- .opencode/command/intake.md — intake command and interview templates (read)
- .opencode/command/implement.md — implementation command (defines expected implement flow)
- .opencode/command/doc.md — documentation authoring command (pre-implementation docs)
- docs/Workflow.md — PRD-driven workflow & policies
- docs/dev/prd/opencode_integration_PRD.md — OpenCode integration PRD

Related issues (Beads ids)
- wf-gn7 — OpenCode integration (recommended parent)
- wf-70j, wf-70j.1, wf-70j.2, wf-70j.3, wf-70j.4, wf-70j.5, wf-70j.6 — PM skill and intake/PRD/bead-plan family (reference)
- wf-5e2 — PM: decompose PRD into bead plan (related)

Risks & assumptions
- Branch protection or GitHub permissions may block agent pushes or PR creation depending on repository settings (confirm actor & permissions).
- The PR actor (bot vs named user) affects branch protections, CI permissions, and audits — confirm desired actor.
- Tests selection: the skill must determine the minimal, relevant tests to run; mis-selection could lead to false confidence.
- Flaky CI/tests may delay human-merge or give false green status.
- Idempotence detection: the skill must reliably detect existing PRs/branches to avoid duplicates (branch name + external-ref matching).
- Human-merge delay: merges will wait for human approval which may lengthen cycle time.
- Secret leakage risk: commits/PR bodies must be scanned to ensure no secrets are added.

Recommended next step
- UPDATE PRD at: docs/dev/prd/opencode_integration_PRD.md to add the Implementation-skill scope, security boundaries, acceptance tests, and enablement checklist; create the bead as a sub-issue under wf-gn7 once this intake is approved.

Areas that could benefit from expansion (clarifying questions)
- Audit trail format: do you want a mandatory bead comment format for every automated action (time, action, branch, PR URL)? (recommended)
- CI gating: must CI be green before a human may merge, or should the skill only "recommend merge" when CI is green? (current draft assumes the skill requires CI green before recommending merge; human merges)
- GitHub actor: should PRs appear from an agent bot account or a named human account? This affects CI permissions and branch protections.

Files / commands referenced
- Files read:
  - docs/dev/CONTEXT_PACK.md
  - .opencode/command/intake.md
  - .opencode/command/implement.md
  - .opencode/command/doc.md
  - docs/dev/prd/opencode_integration_PRD.md (path discovered)
- Command refs: bd create, bd update, bd sync, git commands per .opencode/command/implement.md

